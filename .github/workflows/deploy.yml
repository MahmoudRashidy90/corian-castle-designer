name: Auto Deploy to Server

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Deploy to server via SSH
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.SSH_PASSWORD }}
        port: 21098
        timeout: 30s
        command_timeout: 10s
        script: |
          echo "ðŸš€ Starting deployment..."
          
          # Navigate to web directory
          cd public_html || cd ~/public_html
          
          # Backup current files (optional)
          if [ -d "backup" ]; then
            rm -rf backup
          fi
          mkdir backup
          cp -r * backup/ 2>/dev/null || true
          
          # Download latest code from GitHub
          curl -L https://github.com/mahmoudrashidy90/corian-castle-designer/archive/main.zip -o latest.zip
          
          # Extract and deploy
          unzip -q latest.zip
          cp -r corian-castle-designer-main/* .
          
          # Cleanup
          rm -rf latest.zip corian-castle-designer-main
          
          echo "âœ… Files updated successfully!"
          echo "ðŸŽ‰ Deployment completed!"
